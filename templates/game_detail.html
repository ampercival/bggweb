<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ game.title }}</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; }
    .nav a { margin-right: 1rem; }
    .grid { display: grid; grid-template-columns: 220px 1fr; gap: 8px 16px; max-width: 800px; }
    .label { color: #666; }
    table { border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ddd; padding: 6px 8px; text-align: left; }
    th { background: #f5f5f5; }
  </style>
</head>
<body>
  <div class="nav">
    <a href="/">Home</a>
    <a href="{% url 'games_list' %}">Back to Games</a>
    <a href="{% url 'export_csv' %}">Export CSV</a>
    {% if request.user.is_authenticated and request.user.is_superuser %}
    <a href="{% url 'admin:index' %}">Admin</a>
    {% endif %}
  </div>

  <h1>{{ game.title }}</h1>

  <div class="grid">
    <div class="label">BGG ID</div><div>{{ game.bgg_id }}</div>
    <div class="label">Year</div><div>{{ game.year|default:'N/A' }}</div>
    <div class="label">BGG Rank</div><div>{{ game.bgg_rank|default:'N/A' }}</div>
    <div class="label">Average Rating</div><div>{% if game.avg_rating is not None %}{{ game.avg_rating|floatformat:2 }}{% else %}N/A{% endif %}</div>
    <div class="label">Number of Voters</div><div>{{ game.num_voters }}</div>
    <div class="label">Weight</div><div>{{ game.weight|default:'N/A' }}</div>
    <div class="label">Weight Votes</div><div>{{ game.weight_votes|default:'N/A' }}</div>
    <div class="label">Owned</div><div>{% if game.owned %}Owned{% else %}Not Owned{% endif %}</div>
    <div class="label">Owned By</div><div>{% if game.owned_by %}{{ game.owned_by|join:', ' }}{% else %}None{% endif %}</div>
    <div class="label">Type</div><div>{{ game.type }}</div>
    <div class="label">Categories</div>
    <div>
      {% with cats=game.categories.all %}
        {% if cats %}
          {% for c in cats %}{% if not forloop.first %}, {% endif %}{{ c.name }}{% endfor %}
        {% else %}
          N/A
        {% endif %}
      {% endwith %}
    </div>
    <div class="label">Families</div>
    <div>
      {% with fams=game.families.all %}
        {% if fams %}
          {% for f in fams %}{% if not forloop.first %}, {% endif %}{{ f.name }}{% endfor %}
        {% else %}
          N/A
        {% endif %}
      {% endwith %}
    </div>
    <div class="label">BGG Link</div>
    <div>
      <a href="https://boardgamegeek.com/{% if game.type == 'Expansion' %}boardgameexpansion{% else %}boardgame{% endif %}/{{ game.bgg_id }}" target="_blank" rel="noopener">View on BoardGameGeek</a>
    </div>
  </div>

  <h2>Player Count Recommendations</h2>
  <table>
    <thead>
      <tr>
        <th>Player Count</th>
        <th>Best %</th>
        <th>Best Votes</th>
        <th>Recommended %</th>
        <th>Recommended Votes</th>
        <th>Not Recommended %</th>
        <th>Not Recommended Votes</th>
        <th>Vote Count</th>
      </tr>
    </thead>
    <tbody>
      {% for pc in player_counts %}
      <tr>
        <td>{{ pc.count }}</td>
        <td>{{ pc.best_pct }}</td>
        <td>{{ pc.best_votes }}</td>
        <td>{{ pc.rec_pct }}</td>
        <td>{{ pc.rec_votes }}</td>
        <td>{{ pc.notrec_pct }}</td>
        <td>{{ pc.notrec_votes }}</td>
        <td>{{ pc.vote_count }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="8">No player count data available.</td></tr>
      {% endfor %}
    </tbody>
  </table>

</body>
</html>
